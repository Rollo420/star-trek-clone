# Wir nutzen 3.12-slim für eine gute Mischung aus Stabilität und geringer Größe
FROM python:3.12-slim

# Verhindert, dass Python .pyc Dateien schreibt und sorgt für direktes Terminal-Logging
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# System-Abhängigkeiten (Kein sudo nötig, da wir root sind)
# gcc, graphviz-dev und build-essential werden für pygraphviz benötigt
RUN apt-get update && apt-get install -y \
    gcc \
    python3-dev \
    graphviz \
    graphviz-dev \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Arbeitsverzeichnis im Container festlegen
WORKDIR /app

# 1. Requirements zuerst kopieren (Nutzt Docker-Cache effizient)
# Kopiert die Datei von deinem Docker-Ordner direkt in das Workdir
COPY ./Docker/Django/requirements.txt /app/requirements.txt

# 2. Abhängigkeiten installieren
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r /app/requirements.txt

# 3. Den gesamten App-Code kopieren
# Dies kopiert den Inhalt deines lokalen /app Ordners direkt nach /app im Container
COPY ./app /app/

# Falls manage.py im Unterordner liegt, verschieben wir den Fokus oder 
# stellen sicher, dass die Datei jetzt in /app/manage.py liegt.
RUN ls -la /app

# Port für Django freigeben
EXPOSE 8000

# Startbefehl: Migrationen ausführen und Server starten
# Ohne Warnungen beim Shutdown, wie von dir gewünscht
CMD ["sh", "-c", "python manage.py migrate && python manage.py runserver 0.0.0.0:8000"]